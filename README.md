# üéôÔ∏è Voice Transcription Service

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∑–≤–æ–Ω–∫–æ–≤ –∏–∑ AmoCRM —Å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –≥–æ–≤–æ—Ä—è—â–∏–º) –∏ AI-–∞–Ω–∞–ª–∏–∑–æ–º.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–î–∏–∞—Ä–∏–∑–∞—Ü–∏—è** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–æ–≤–æ—Ä—è—â–∏–º (–ú–µ–Ω–µ–¥–∂–µ—Ä/–ö–ª–∏–µ–Ω—Ç)
- ‚úÖ **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** ‚Äî AssemblyAI –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- ‚úÖ **AI-–∞–Ω–∞–ª–∏–∑** ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ GPT
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** ‚Äî webhook –æ—Ç AmoCRM –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–≤–æ–Ω–∫–∞
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî Telegram –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üìã –ò–∑–≤–ª–µ–∫–∞–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞
- –ì–æ—Ä–æ–¥
- –¢–∏–ø —Ä–∞–±–æ—Ç
- –°—Ç–æ–∏–º–æ—Å—Ç—å
- –£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã
- –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- –ó–∞–¥–∞—á–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- –ò—Ç–æ–≥ –∑–≤–æ–Ω–∫–∞
- –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
voice-transcription/
‚îú‚îÄ‚îÄ main.py              # FastAPI —Å–µ—Ä–≤–µ—Ä + webhook
‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ amocrm.py        # –†–∞–±–æ—Ç–∞ —Å AmoCRM API
‚îÇ   ‚îú‚îÄ‚îÄ transcription.py # AssemblyAI —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ analysis.py      # GPT –∞–Ω–∞–ª–∏–∑
‚îÇ   ‚îî‚îÄ‚îÄ telegram.py      # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Procfile            # –î–ª—è Railway
‚îî‚îÄ‚îÄ railway.toml        # –ö–æ–Ω—Ñ–∏–≥ Railway
```

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Railway

### 1. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ Railway

1. –ó–∞–π–¥–∏ –Ω–∞ [railway.app](https://railway.app)
2. New Project ‚Üí Deploy from GitHub repo
3. –í—ã–±–µ—Ä–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —ç—Ç–∏–º –∫–æ–¥–æ–º

### 2. –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í Railway Dashboard ‚Üí Variables –¥–æ–±–∞–≤—å:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------------|----------|
| `AMOCRM_DOMAIN` | —Ç–≤–æ–π-–¥–æ–º–µ–Ω.amocrm.ru |
| `AMOCRM_ACCESS_TOKEN` | —Ç–æ–∫–µ–Ω –∏–∑ AmoCRM |
| `ASSEMBLYAI_API_KEY` | –∫–ª—é—á –∏–∑ AssemblyAI |
| `OPENAI_API_KEY` | –∫–ª—é—á –∏–∑ OpenAI |
| `TELEGRAM_BOT_TOKEN` | —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `TELEGRAM_CHAT_ID` | ID —á–∞—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `APP_TIMEZONE` | —Ç–∞–π–º–∑–æ–Ω–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–∞–ø—Ä. `Europe/Moscow`) |

### 3. –ü–æ–ª—É—á–∏ URL —Å–µ—Ä–≤–∏—Å–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è Railway –¥–∞—Å—Ç URL —Ç–∏–ø–∞:
`https://your-service.up.railway.app`

### 4. –ù–∞—Å—Ç—Ä–æ–π webhook –≤ AmoCRM

1. –ó–∞–π–¥–∏ –≤ AmoCRM ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí Webhooks
2. –î–æ–±–∞–≤—å –Ω–æ–≤—ã–π webhook:
   - **URL**: `https://your-service.up.railway.app/webhook/amocrm`
   - **–°–æ–±—ã—Ç–∏—è**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è (note_add)

## üîß –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd voice-transcription

# –°–æ–∑–¥–∞–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # –∏–ª–∏ venv\Scripts\activate –Ω–∞ Windows

# –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –°–æ–∑–¥–∞–π .env —Ñ–∞–π–ª (—Å–∫–æ–ø–∏—Ä—É–π –∏–∑ ENV_EXAMPLE.txt)
cp ENV_EXAMPLE.txt .env
# –ó–∞–ø–æ–ª–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ .env

# –ó–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä
python main.py
```

## üì° API Endpoints

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ |
| GET | `/health` | Health check |
| POST | `/webhook/amocrm` | Webhook –¥–ª—è AmoCRM |
| POST | `/webhook/amocrm/geodesist-assigned` | Webhook: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–µ–æ–¥–µ–∑–∏—Å—Ç–∞ (MAX/Wappi) |
| POST | `/webhook/test` | –¢–µ—Å—Ç–æ–≤—ã–π endpoint |

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

```bash
curl -X POST https://your-service.up.railway.app/webhook/test \
  -H "Content-Type: application/json" \
  -d '{
    "lead_id": 12345,
    "record_url": "https://url-to-audio-file.mp3",
    "call_type": "outgoing_call",
    "responsible_user_id": 123
  }'
```

## üìù –§–æ—Ä–º–∞—Ç –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –≤ AmoCRM

```
üéôÔ∏è –†–ê–°–®–ò–§–†–û–í–ö–ê –ó–í–û–ù–ö–ê (AI)

üìû –ó–≤–æ–Ω–æ–∫: –ò—Å—Ö–æ–¥—è—â–∏–π | 5 –º–∏–Ω 32 —Å–µ–∫
üë§ –ö–ª–∏–µ–Ω—Ç: –ò–≤–∞–Ω–æ–≤ –°–µ—Ä–≥–µ–π –ü–µ—Ç—Ä–æ–≤–∏—á
üìç –ì–æ—Ä–æ–¥: –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä
üë®‚Äçüíº –ú–µ–Ω–µ–¥–∂–µ—Ä: –ï–ª–µ–Ω–∞

üìù –°–£–¢–¨ –†–ê–ó–ì–û–í–û–†–ê:
–ö–ª–∏–µ–Ω—Ç –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è –≥–µ–æ–¥–µ–∑–∏—á–µ—Å–∫–æ–π —Å—ä—ë–º–∫–æ–π —É—á–∞—Å—Ç–∫–∞ 
–ø–æ–¥ –ò–ñ–°. –£—á–∞—Å—Ç–æ–∫ 12 —Å–æ—Ç–æ–∫ –≤ –ø—Ä–∏–≥–æ—Ä–æ–¥–µ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞.

üîß –¢–∏–ø —Ä–∞–±–æ—Ç—ã: –¢–æ–ø–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Å—ä—ë–º–∫–∞ 1:500
üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: 18 000 ‚ÇΩ
üí≥ –û–ø–ª–∞—Ç–∞: –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 50%

üìä –ò—Ç–æ–≥: –î–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –æ —Ä–∞–±–æ—Ç–µ
üìÖ –°–ª–µ–¥—É—é—â–∏–π –∫–æ–Ω—Ç–∞–∫—Ç: –°—Ä–µ–¥–∞, 15 —è–Ω–≤–∞—Ä—è

‚úÖ –ó–ê–î–ê–ß–ò –ú–ï–ù–ï–î–ñ–ï–†–£:
‚Ä¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä –Ω–∞ email –¥–æ 15.01
‚Ä¢ –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –¥–∞—Ç—É –≤—ã–µ–∑–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é
‚Ä¢ –ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å –≤ —Å—Ä–µ–¥—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
```

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

| –°–µ—Ä–≤–∏—Å | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|-----------|
| Railway | $5/–º–µ—Å (—É–∂–µ –æ–ø–ª–∞—á–µ–Ω) |
| AssemblyAI | ~$0.01/–º–∏–Ω –∞—É–¥–∏–æ |
| OpenAI GPT-4o-mini | ~$0.0001/–∑–∞–ø—Ä–æ—Å |

**–ü—Ä–∏–º–µ—Ä**: 100 –∑–≤–æ–Ω–∫–æ–≤ –ø–æ 5 –º–∏–Ω—É—Ç = ~$5-7/–º–µ—Å

## ‚ùì Troubleshooting

### –ù–µ—Ç –∑–∞–ø–∏—Å–∏ –∑–≤–æ–Ω–∫–∞
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ AmoCRM –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∑–∞–ø–∏—Å—å –∑–≤–æ–Ω–∫–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—å ASSEMBLYAI_API_KEY
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π (<10KB)

### –û—à–∏–±–∫–∞ AmoCRM
- –ü—Ä–æ–≤–µ—Ä—å AMOCRM_ACCESS_TOKEN (–º–æ–∂–µ—Ç –∏—Å—Ç–µ—á—å)
- –û–±–Ω–æ–≤–∏ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ refresh_token

---

Made with ‚ù§Ô∏è for –≥–µ–æ–¥–µ–∑–∏—è
